---
title: 'Predicting the Operational Status of Tanzanian Water Pumps'
subtitle: 'Data Processing'
author: "Thomas Skowronek"
date: "January 27, 2018"
output:
  html_document: default
  pdf_document: default
  word_document: default
---


```{r setup-layout, cache=FALSE, echo=FALSE}
# Define the report layout.
library(knitr)

# Set global chunk options: images sizes for html and docx
output <- opts_knit$get("rmarkdown.pandoc.to")

if (output=="html") opts_chunk$set(fig.width=10, fig.height=6)
if (output=="docx") opts_chunk$set(fig.width=10,  fig.height=6)

# Set the printable width
options(width = 85)
```
\newline


# Setup
Set the working directory, clear all existing objects in the workspace and set the seed for reproducibility.  Lastly, load the necessary libraries.
```{r env-config, warning=FALSE, message=FALSE}
# Set the working directory
setwd("./")

# Clear all existing objects in the workspace
rm(list = ls())

# Set the seed for reproducible results
set.seed(1009)

# Load libraries
library(dplyr)
library(stringr)
```
\newline


# Attribute Definitions:
* id - Well identifier
* amount_tsh - Total static head (amount water available to waterpoint)
* date_recorded - The date the row was entered
* funder - Who funded the well
* gps_height - Altitude of the well
* installer - Organization that installed the well
* longitude - GPS coordinate
* latitude - GPS coordinate
* wpt_name - Name of the waterpoint if there is one
* num_private -
* basin - Geographic water basin
* subvillage - Geographic location
* region - Geographic location
* region_code - Geographic location (coded)
* district_code - Geographic location (coded)
* lga - Geographic location
* ward - Geographic location
* population - Population around the well
* public_meeting - True/False
* recorded_by - Group entering this row of data
* scheme_management - Who operates the waterpoint
* scheme_name - Who operates the waterpoint
* permit - If the waterpoint is permitted
* construction_year - Year the waterpoint was constructed
* extraction_type - The kind of extraction the waterpoint uses
* extraction_type_group - The kind of extraction the waterpoint uses
* extraction_type_class - The kind of extraction the waterpoint uses
* management - How the waterpoint is managed
* management_group - How the waterpoint is managed
* payment - What the water costs
* payment_type - What the water costs
* water_quality - The quality of the water
* quality_group - The quality of the water
* quantity - The quantity of water
* quantity_group - The quantity of water
* source - The source of the water
* source_type - The source of the water
* source_class - The source of the water
* waterpoint_type - The kind of waterpoint
* waterpoint_type_group - The kind of waterpoint
* status_group - The operational status of the well
    + functional - the waterpoint is operational and there are no repairs needed
    + functional needs repair - the waterpoint is operational, but needs repairs
    + non functional - the waterpoint is not operational

\newline


# Data Preperation

## Load the datasets
```{r load-data}
train.values <- read.csv("../data/src-training-set-values.csv", header = TRUE, na.strings = "")
train.labels <- read.csv("../data/src-training-set-labels.csv", header = TRUE)
test.values <- read.csv("../data/src-test-set-values.csv", header = TRUE, na.strings = "")
```
\newline


## Inspect the original structure of the datasets
```{r inspect-structure}
str(train.values)
str(train.labels)
str(test.values)
```
\newline


## Convert data types
```{r data-conversion}
# Convert the training values
train.values$date_recorded <- as.Date(train.values$date_recorded)
train.values$region_code <- as.factor(train.values$region_code)
train.values$district_code <- as.factor(train.values$district_code)
train.values$construction_year <- as.factor(train.values$construction_year)

# Convert the training labels
train.labels$status_group <- as.factor(train.labels$status_group)

# Convert the test values
test.values$date_recorded <- as.Date(test.values$date_recorded)
test.values$region_code <- as.factor(test.values$region_code)
test.values$district_code <- as.factor(test.values$district_code)
test.values$construction_year <- as.factor(test.values$construction_year)
```
\newline


## Add new features to address outliers
```{r new-features-outliers}
# Apply log to attributes with outliers
train.values <- train.values %>% 
  mutate(amount_tsh.log = log(amount_tsh), population.log = log(population))

test.values <- test.values %>% 
  mutate(amount_tsh.log = log(amount_tsh), population.log = log(population))

train.scale <- as.data.frame(scale(train.values[, c("amount_tsh", "population")]))
test.scale <- as.data.frame(scale(test.values[, c("amount_tsh", "population")]))

names(train.scale) <- c("amount_tsh.scale", "population.scale")
names(test.scale) <- c("amount_tsh.scale", "population.scale")

train.values <- cbind(train.values, train.scale)
test.values <- cbind(test.values, test.scale)
```
\newline


## Cleanse attribute data
```{r data-cleanse}
missing.values <- c("none", "0", "-")

train.values$funder[tolower(train.values$funder) %in% missing.values] <- NA
train.values$installer[tolower(train.values$installer) %in% missing.values] <- NA
train.values$wpt_name[tolower(train.values$wpt_name) %in% missing.values] <- NA
train.values$construction_year[tolower(train.values$construction_year) %in% missing.values] <- NA
train.values$population[tolower(train.values$population) %in% missing.values] <- NA

# Alter observations that contain factor levels not present in the test data
train.values$scheme_management[tolower(train.values$scheme_management) == "none"] <- NA

test.values$funder[tolower(test.values$funder) %in% missing.values] <- NA
test.values$installer[tolower(test.values$installer) %in% missing.values] <- NA
test.values$wpt_name[tolower(test.values$wpt_name) %in% missing.values] <- NA
test.values$construction_year[tolower(test.values$construction_year) %in% missing.values] <- NA
test.values$population[tolower(test.values$population) %in% missing.values] <- NA
```
\newline


## Add new categorical features
```{r new-features-categorical}
# Bin the funders
train.values <- train.values %>% 
  mutate(funder.bin = case_when(str_detect(tolower(funder), "german") ~ "german", 
                                 str_detect(tolower(funder), "church") ~ "church",  
                                 str_detect(tolower(funder), "africa") ~ "africa",
                                 str_detect(tolower(funder), "foundation") ~ "foundation",
                                 str_detect(tolower(funder), "agency") ~ "agency",
                                 #str_detect(tolower(funder), "committee") ~ "committee",
                                 str_detect(tolower(funder), "network") ~ "network",
                                 str_detect(tolower(funder), "community") ~ "community",
                                 str_detect(tolower(funder), "government") ~ "government",
                                 str_detect(tolower(funder), "company") ~ "company",
                                 str_detect(tolower(funder), "british") ~ "british",
                                 str_detect(tolower(funder), "trust") ~ "trust",
                                 str_detect(tolower(funder), "aid") ~ "aid",
                                 str_detect(tolower(funder), "council") ~ "council",
                                 str_detect(tolower(funder), "bank") ~ "bank",
                                 str_detect(tolower(funder), "fund") ~ "fund",
                                 str_detect(tolower(funder), "mission") ~ "mission",
                                 str_detect(tolower(funder), "ltd") ~ "ltd",
                                 str_detect(tolower(funder), "diocese") ~ "church",
                                 str_detect(tolower(funder), "egypt") ~ "egypt",
                                 str_detect(tolower(funder), "conservation") ~ "conservation",
                                 str_detect(tolower(funder), "missionary") ~ "missionary",
                                 str_detect(tolower(funder), "institution") ~ "institution",
                                 str_detect(tolower(funder), "japan") ~ "japan",
                                 str_detect(tolower(funder), "irish") ~ "irish",
                                 str_detect(tolower(funder), "islamic") ~ "islamic",
                                 str_detect(tolower(funder), "ital") ~ "italy",
                                 str_detect(tolower(funder), "kanis") ~ "kanis",
                                 str_detect(tolower(funder), "kkkt") ~ "kkkt",
                                 str_detect(tolower(funder), "lgc") ~ "lgc",
                                 str_detect(tolower(funder), "school") ~ "school",
                                 str_detect(tolower(funder), "project") ~ "project",
                                 str_detect(tolower(funder), "society") ~ "society",
                                 str_detect(tolower(funder), "netherland") ~ "netherland",
                                 str_detect(tolower(funder), "village") ~ "village",
                                 str_detect(tolower(funder), "norad") ~ "norad",
                                 str_detect(tolower(funder), "european") ~ "european",
                                 str_detect(tolower(funder), "sweeden") ~ "sweeden",
                                 str_detect(tolower(funder), "international") ~ "international",
                                 str_detect(tolower(funder), "rc") ~ "rc",
                                 str_detect(tolower(funder), "regional") ~ "regional",
                                 str_detect(tolower(funder), "water") ~ "water",
                                 str_detect(tolower(funder), "roman") ~ "church",
                                 str_detect(tolower(funder), "rotary") ~ "rotary",
                                 str_detect(tolower(funder), "lion") ~ "lion",
                                 str_detect(tolower(funder), "department") ~ "department",
                                 str_detect(tolower(funder), "hospi") ~ "hospital",
                                 str_detect(tolower(funder), "swed") ~ "swedish",
                                 str_detect(tolower(funder), "swiss") ~ "swiss",
                                 str_detect(tolower(funder), "tlc") ~ "tlc",
                                 str_detect(tolower(funder), "unicef") ~ "unicef",
                                 str_detect(tolower(funder), "embassy") ~ "embassy",
                                 str_detect(tolower(funder), "board") ~ "board",
                                 str_detect(tolower(funder), "authority") ~ "authority",
                                 str_detect(tolower(funder), "group") ~ "group",
                                 str_detect(tolower(funder), "hesawa") ~ "hesawa",
                                 str_detect(tolower(funder), "rwssp") ~ "rwssp",
                                 str_detect(tolower(funder), "world vision") ~ "world vision",
                                 str_detect(tolower(funder), "tasaf") ~ "tasaf",
                                 str_detect(tolower(funder), "dhv") ~ "dhv",
                                 str_detect(tolower(funder), "private") ~ "private",
                                 str_detect(tolower(funder), "dwsp") ~ "dwsp",
                                 str_detect(tolower(funder), "dhv") ~ "dhv",
                                 str_detect(tolower(funder), "norad") ~ "norad",
                                 str_detect(tolower(funder), "tcrs") ~ "tcrs",
                                 str_detect(tolower(funder), "dwe") ~ "dwe",
                                 str_detect(tolower(funder), "netherlands") ~ "netherlands",
                                 str_detect(tolower(funder), "hifab") ~ "hifab",
                                 str_detect(tolower(funder), "adb") ~ "adb",
                                 str_detect(tolower(funder), "lga") ~ "lga",
                                 str_detect(tolower(funder), "amref") ~ "amref",
                                 str_detect(tolower(funder), "oxfam") ~ "oxfam",
                                 str_detect(tolower(funder), "oxfarm") ~ "oxfam",
                                 str_detect(tolower(funder), "isf") ~ "isf",
                                 str_detect(tolower(funder), "rudep") ~ "rudep",
                                 str_detect(tolower(funder), "jaica") ~ "jaica",
                                 str_detect(tolower(funder), "adra") ~ "adra",
                                 str_detect(tolower(funder), "jica") ~ "jica",
                                 str_detect(tolower(funder), "shipo") ~ "shipo",
                                 str_detect(tolower(funder), "wsdp") ~ "wsdp",
                                 str_detect(tolower(funder), "finw") ~ "finw",
                                 str_detect(tolower(funder), "dh") ~ "dh",
                                 str_detect(tolower(funder), "dh") ~ "dh",
                                 str_detect(tolower(funder), "plan int") ~ "plan int",
                                 str_detect(tolower(funder), "dmdd") ~ "dmdd",
                                 str_detect(tolower(funder), "fw") ~ "fw",
                                 str_detect(tolower(funder), "w.b") ~ "w.b",
                                 str_detect(tolower(funder), "wvt") ~ "wvt",
                                 str_detect(tolower(funder), "oikos e.afrika") ~ "oikos e.afrika",
                                 str_detect(tolower(funder), "nethalan") ~ "netherland",
                                 str_detect(tolower(funder), "mkinga distric coun") ~ "district",
                                 str_detect(tolower(funder), "lvia") ~ "lvia",
                                 str_detect(tolower(funder), "concern world wide") ~ "concern",
                                 str_detect(tolower(funder), "unhcr") ~ "unhcr",
                                 str_detect(tolower(funder), "tardo") ~ "tardo",
                                 str_detect(tolower(funder), "snv") ~ "snv",
                                 str_detect(tolower(funder), "wananchi") ~ "wananchi",
                                 str_detect(tolower(funder), "wua") ~ "wua",
                                 str_detect(tolower(funder), "unice") ~ "unicef",
                                 str_detect(tolower(funder), "bsf") ~ "bsf",
                                 str_detect(tolower(funder), "tassaf") ~ "tasaf",
                                 str_detect(tolower(funder), "dfid") ~ "dfid",
                                 str_detect(tolower(funder), "lamp") ~ "lamp",
                                 str_detect(tolower(funder), "go") ~ "go",
                                 str_detect(tolower(funder), "concern") ~ "concern",
                                 str_detect(tolower(funder), "muwsa") ~ "muwsa",
                                 str_detect(tolower(funder), "villagers") ~ "village",
                                 str_detect(tolower(funder), "ru") ~ "ru",
                                 str_detect(tolower(funder), "village council") ~ "village",
                                 str_detect(tolower(funder), "halmashauri ya wilaya sikonge") ~ "halmashauri ya wilaya sikonge",
                                 str_detect(tolower(funder), "hsw") ~ "hsw",
                                 str_detect(tolower(funder), "go") ~ "ngo",
                                 str_detect(tolower(funder), "ngo") ~ "ngo",
                                 str_detect(tolower(funder), "danida") ~ "danida",
                                 str_detect(tolower(funder), "ces\\(gmbh\\)") ~ "ces (gmbh)",
                                 str_detect(tolower(funder), "ces \\(gmbh\\)") ~ "ces (gmbh)",
                                 str_detect(tolower(funder), "ded") ~ "ded",
                                 str_detect(tolower(funder), "no") ~ "no",
                                 str_detect(tolower(funder), "he") ~ "he",
                                 str_detect(tolower(funder), "is") ~ "is",
                                 str_detect(tolower(funder), "ki") ~ "ki",
                                 str_detect(tolower(funder), "ir") ~ "ir",
                                 str_detect(tolower(funder), "co") ~ "co",
                                 is.na(funder) ~ "unknown",
                                 TRUE ~ "other"))

train.values %>% count(funder.bin) %>% as.data.frame

train.values %>% filter(funder.bin == "other") %>% 
  group_by(funder) %>% count(funder) %>%
  arrange(desc(n)) %>% as.data.frame


# Bin the funders
test.values <- test.values %>% 
  mutate(funder.bin = case_when(str_detect(tolower(funder), "german") ~ "german", 
                                 str_detect(tolower(funder), "church") ~ "church",  
                                 str_detect(tolower(funder), "africa") ~ "africa",
                                 str_detect(tolower(funder), "foundation") ~ "foundation",
                                 str_detect(tolower(funder), "agency") ~ "agency",
                                 #str_detect(tolower(funder), "committee") ~ "committee",
                                 str_detect(tolower(funder), "network") ~ "network",
                                 str_detect(tolower(funder), "community") ~ "community",
                                 str_detect(tolower(funder), "government") ~ "government",
                                 str_detect(tolower(funder), "company") ~ "company",
                                 str_detect(tolower(funder), "british") ~ "british",
                                 str_detect(tolower(funder), "trust") ~ "trust",
                                 str_detect(tolower(funder), "aid") ~ "aid",
                                 str_detect(tolower(funder), "council") ~ "council",
                                 str_detect(tolower(funder), "bank") ~ "bank",
                                 str_detect(tolower(funder), "fund") ~ "fund",
                                 str_detect(tolower(funder), "mission") ~ "mission",
                                 str_detect(tolower(funder), "ltd") ~ "ltd",
                                 str_detect(tolower(funder), "diocese") ~ "church",
                                 str_detect(tolower(funder), "egypt") ~ "egypt",
                                 str_detect(tolower(funder), "conservation") ~ "conservation",
                                 str_detect(tolower(funder), "missionary") ~ "missionary",
                                 str_detect(tolower(funder), "institution") ~ "institution",
                                 str_detect(tolower(funder), "japan") ~ "japan",
                                 str_detect(tolower(funder), "irish") ~ "irish",
                                 str_detect(tolower(funder), "islamic") ~ "islamic",
                                 str_detect(tolower(funder), "ital") ~ "italy",
                                 str_detect(tolower(funder), "kanis") ~ "kanis",
                                 str_detect(tolower(funder), "kkkt") ~ "kkkt",
                                 str_detect(tolower(funder), "lgc") ~ "lgc",
                                 str_detect(tolower(funder), "school") ~ "school",
                                 str_detect(tolower(funder), "project") ~ "project",
                                 str_detect(tolower(funder), "society") ~ "society",
                                 str_detect(tolower(funder), "netherland") ~ "netherland",
                                 str_detect(tolower(funder), "village") ~ "village",
                                 str_detect(tolower(funder), "norad") ~ "norad",
                                 str_detect(tolower(funder), "european") ~ "european",
                                 str_detect(tolower(funder), "sweeden") ~ "sweeden",
                                 str_detect(tolower(funder), "international") ~ "international",
                                 str_detect(tolower(funder), "rc") ~ "rc",
                                 str_detect(tolower(funder), "regional") ~ "regional",
                                 str_detect(tolower(funder), "water") ~ "water",
                                 str_detect(tolower(funder), "roman") ~ "church",
                                 str_detect(tolower(funder), "rotary") ~ "rotary",
                                 str_detect(tolower(funder), "lion") ~ "lion",
                                 str_detect(tolower(funder), "department") ~ "department",
                                 str_detect(tolower(funder), "hospi") ~ "hospital",
                                 str_detect(tolower(funder), "swed") ~ "swedish",
                                 str_detect(tolower(funder), "swiss") ~ "swiss",
                                 str_detect(tolower(funder), "tlc") ~ "tlc",
                                 str_detect(tolower(funder), "unicef") ~ "unicef",
                                 str_detect(tolower(funder), "embassy") ~ "embassy",
                                 str_detect(tolower(funder), "board") ~ "board",
                                 str_detect(tolower(funder), "authority") ~ "authority",
                                 str_detect(tolower(funder), "group") ~ "group",
                                 str_detect(tolower(funder), "hesawa") ~ "hesawa",
                                 str_detect(tolower(funder), "rwssp") ~ "rwssp",
                                 str_detect(tolower(funder), "world vision") ~ "world vision",
                                 str_detect(tolower(funder), "tasaf") ~ "tasaf",
                                 str_detect(tolower(funder), "dhv") ~ "dhv",
                                 str_detect(tolower(funder), "private") ~ "private",
                                 str_detect(tolower(funder), "dwsp") ~ "dwsp",
                                 str_detect(tolower(funder), "dhv") ~ "dhv",
                                 str_detect(tolower(funder), "norad") ~ "norad",
                                 str_detect(tolower(funder), "tcrs") ~ "tcrs",
                                 str_detect(tolower(funder), "dwe") ~ "dwe",
                                 str_detect(tolower(funder), "netherlands") ~ "netherlands",
                                 str_detect(tolower(funder), "hifab") ~ "hifab",
                                 str_detect(tolower(funder), "adb") ~ "adb",
                                 str_detect(tolower(funder), "lga") ~ "lga",
                                 str_detect(tolower(funder), "amref") ~ "amref",
                                 str_detect(tolower(funder), "oxfam") ~ "oxfam",
                                 str_detect(tolower(funder), "oxfarm") ~ "oxfam",
                                 str_detect(tolower(funder), "isf") ~ "isf",
                                 str_detect(tolower(funder), "rudep") ~ "rudep",
                                 str_detect(tolower(funder), "jaica") ~ "jaica",
                                 str_detect(tolower(funder), "adra") ~ "adra",
                                 str_detect(tolower(funder), "jica") ~ "jica",
                                 str_detect(tolower(funder), "shipo") ~ "shipo",
                                 str_detect(tolower(funder), "wsdp") ~ "wsdp",
                                 str_detect(tolower(funder), "finw") ~ "finw",
                                 str_detect(tolower(funder), "dh") ~ "dh",
                                 str_detect(tolower(funder), "dh") ~ "dh",
                                 str_detect(tolower(funder), "plan int") ~ "plan int",
                                 str_detect(tolower(funder), "dmdd") ~ "dmdd",
                                 str_detect(tolower(funder), "fw") ~ "fw",
                                 str_detect(tolower(funder), "w.b") ~ "w.b",
                                 str_detect(tolower(funder), "wvt") ~ "wvt",
                                 str_detect(tolower(funder), "oikos e.afrika") ~ "oikos e.afrika",
                                 str_detect(tolower(funder), "nethalan") ~ "netherland",
                                 str_detect(tolower(funder), "mkinga distric coun") ~ "district",
                                 str_detect(tolower(funder), "lvia") ~ "lvia",
                                 str_detect(tolower(funder), "concern world wide") ~ "concern",
                                 str_detect(tolower(funder), "unhcr") ~ "unhcr",
                                 str_detect(tolower(funder), "tardo") ~ "tardo",
                                 str_detect(tolower(funder), "snv") ~ "snv",
                                 str_detect(tolower(funder), "wananchi") ~ "wananchi",
                                 str_detect(tolower(funder), "wua") ~ "wua",
                                 str_detect(tolower(funder), "unice") ~ "unicef",
                                 str_detect(tolower(funder), "bsf") ~ "bsf",
                                 str_detect(tolower(funder), "tassaf") ~ "tasaf",
                                 str_detect(tolower(funder), "dfid") ~ "dfid",
                                 str_detect(tolower(funder), "lamp") ~ "lamp",
                                 str_detect(tolower(funder), "go") ~ "go",
                                 str_detect(tolower(funder), "concern") ~ "concern",
                                 str_detect(tolower(funder), "muwsa") ~ "muwsa",
                                 str_detect(tolower(funder), "villagers") ~ "village",
                                 str_detect(tolower(funder), "ru") ~ "ru",
                                 str_detect(tolower(funder), "village council") ~ "village",
                                 str_detect(tolower(funder), "halmashauri ya wilaya sikonge") ~ "halmashauri ya wilaya sikonge",
                                 str_detect(tolower(funder), "hsw") ~ "hsw",
                                 str_detect(tolower(funder), "go") ~ "ngo",
                                 str_detect(tolower(funder), "ngo") ~ "ngo",
                                 str_detect(tolower(funder), "danida") ~ "danida",
                                 str_detect(tolower(funder), "ces\\(gmbh\\)") ~ "ces (gmbh)",
                                 str_detect(tolower(funder), "ces \\(gmbh\\)") ~ "ces (gmbh)",
                                 str_detect(tolower(funder), "ded") ~ "ded",
                                 str_detect(tolower(funder), "no") ~ "no",
                                 str_detect(tolower(funder), "he") ~ "he",
                                 str_detect(tolower(funder), "is") ~ "is",
                                 str_detect(tolower(funder), "ki") ~ "ki",
                                 str_detect(tolower(funder), "ir") ~ "ir",
                                 str_detect(tolower(funder), "co") ~ "co",
                                 is.na(funder) ~ "unknown",
                                 TRUE ~ "other"))

test.values %>% count(funder.bin) %>% as.data.frame

test.values %>% filter(funder.bin == "other") %>% 
  group_by(funder) %>% count(funder) %>%
  arrange(desc(n)) %>% as.data.frame


# Bin the installers
train.values <- train.values %>% 
  mutate(installer.bin = case_when(str_detect(tolower(installer), "dwe") ~ "dwe", 
                                str_detect(tolower(installer), "government") ~ "government",
                                str_detect(tolower(installer), "hesawa") ~ "hesawa",
                                str_detect(tolower(installer), "rwe") ~ "rwe",
                                str_detect(tolower(installer), "commu") ~ "community",
                                str_detect(tolower(installer), "danid") ~ "danida",
                                str_detect(tolower(installer), "district council") ~ "district council",
                                str_detect(tolower(installer), "kkkt") ~ "kkkt",
                                str_detect(tolower(installer), "tcrs") ~ "tcrs",
                                str_detect(tolower(installer), "world vision") ~ "world vision",
                                str_detect(tolower(installer), "ces") ~ "ces",
                                str_detect(tolower(installer), "gover") ~ "government",
                                str_detect(tolower(installer), "amref") ~ "amref",
                                str_detect(tolower(installer), "lga") ~ "lga",
                                str_detect(tolower(installer), "tasaf") ~ "tasaf",
                                str_detect(tolower(installer), "wedeco") ~ "wedeco",
                                str_detect(tolower(installer), "fini water") ~ "fini water",
                                str_detect(tolower(installer), "dmdd") ~ "dmdd",
                                str_detect(tolower(installer), "norad") ~ "norad",
                                str_detect(tolower(installer), "twesa") ~ "twesa",
                                str_detect(tolower(installer), "da") ~ "da",
                                str_detect(tolower(installer), "wu") ~ "wu",
                                str_detect(tolower(installer), "acra") ~ "acra",
                                str_detect(tolower(installer), "sema") ~ "sema",
                                str_detect(tolower(installer), "dw") ~ "dw",
                                str_detect(tolower(installer), "oxfam") ~ "oxfam",
                                str_detect(tolower(installer), "unicef") ~ "unicef",
                                str_detect(tolower(installer), "shipo") ~ "shipo",
                                str_detect(tolower(installer), "idara ya maji") ~ "idara ya maji",
                                str_detect(tolower(installer), "gove") ~ "government",
                                str_detect(tolower(installer), "villagers") ~ "village",
                                str_detect(tolower(installer), "sengerema water department") ~ "sengerema water department",
                                str_detect(tolower(installer), "kiliwater") ~ "kiliwater",
                                str_detect(tolower(installer), "finw") ~ "fini water",
                                str_detect(tolower(installer), "rc church") ~ "rc church",
                                str_detect(tolower(installer), "dh") ~ "dh",
                                str_detect(tolower(installer), "kuwait") ~ "kuwait",
                                str_detect(tolower(installer), "dwsp") ~ "dwsp",
                                str_detect(tolower(installer), "distri") ~ "district",
                                str_detect(tolower(installer), "lawatefuka water sup") ~ "lawatefuka water sup",
                                str_detect(tolower(installer), "rc") ~ "rc church",
                                str_detect(tolower(installer), "magadini-makiwaru wa") ~ "magadini-makiwaru wa",
                                str_detect(tolower(installer), "fw") ~ "fw",
                                str_detect(tolower(installer), "district water department") ~ "district water department",
                                str_detect(tolower(installer), "kkkt _ konde and dwe") ~ "kkkt",
                                str_detect(tolower(installer), "centr") ~ "centr",
                                str_detect(tolower(installer), "private") ~ "private",
                                str_detect(tolower(installer), "wvt") ~ "wvt",
                                str_detect(tolower(installer), "mwe") ~ "mwe",
                                str_detect(tolower(installer), "handeni trunk main") ~ "handeni trunk main",
                                str_detect(tolower(installer), "water aid") ~ "water aid",
                                str_detect(tolower(installer), "world bank") ~ "world bank",
                                str_detect(tolower(installer), "wananchi") ~ "wananchi",
                                str_detect(tolower(installer), "rwssp") ~ "rwssp",
                                str_detect(tolower(installer), "jica") ~ "jica",
                                str_detect(tolower(installer), "central govt") ~ "government",
                                str_detect(tolower(installer), "adra") ~ "adra",
                                str_detect(tolower(installer), "artisan") ~ "artisan",
                                str_detect(tolower(installer), "isf") ~ "isf",
                                str_detect(tolower(installer), "mission") ~ "mission",
                                str_detect(tolower(installer), "ddca") ~ "ddca",
                                str_detect(tolower(installer), "he") ~ "he",
                                str_detect(tolower(installer), "tardo") ~ "tardo",
                                str_detect(tolower(installer), "consulting engineer") ~ "consulting engineer",
                                str_detect(tolower(installer), "twe") ~ "twe",
                                str_detect(tolower(installer), "muwsa") ~ "muwsa",
                                str_detect(tolower(installer), "ded") ~ "ded",
                                str_detect(tolower(installer), "village council") ~ "village",
                                str_detect(tolower(installer), "halmashauri ya wilaya sikonge") ~ "halmashauri ya wilaya sikonge",
                                str_detect(tolower(installer), "wizara ya maji") ~ "wizara ya maji",
                                str_detect(tolower(installer), "hsw") ~ "hsw",
                                str_detect(tolower(installer), "go") ~ "go",
                                str_detect(tolower(installer), "unisef") ~ "unicef",
                                str_detect(tolower(installer), "angli") ~ "angli",
                                str_detect(tolower(installer), "is") ~ "is",
                                str_detect(tolower(installer), "jaica") ~ "jaica",
                                str_detect(tolower(installer), "world") ~ "world",
                                str_detect(tolower(installer), "ir") ~ "ir",
                                str_detect(tolower(installer), "tassaf") ~ "tasaf",
                                str_detect(tolower(installer), "ki") ~ "ki",
                                str_detect(tolower(installer), "roman") ~ "roman",
                                str_detect(tolower(installer), "vwc") ~ "vwc",
                                str_detect(tolower(installer), "aict") ~ "aict",
                                str_detect(tolower(installer), "mdrdp") ~ "mdrdp",
                                str_detect(tolower(installer), "water board") ~ "water board",
                                str_detect(tolower(installer), "oikos e .africa") ~ "oikos e .africa",
                                str_detect(tolower(installer), "region water department") ~ "region water department",
                                str_detect(tolower(installer), "cefa") ~ "cefa",
                                str_detect(tolower(installer), "chamavita") ~ "chamavita",
                                str_detect(tolower(installer), "lwi") ~ "lwi",
                                str_detect(tolower(installer), "mtn") ~ "mtn",
                                str_detect(tolower(installer), "villa") ~ "village",
                                str_detect(tolower(installer), "gtz") ~ "gtz",
                                str_detect(tolower(installer), "oxfarm") ~ "oxfam",
                                is.na(installer) ~ "unknown",
                                TRUE ~ "other"))

train.values %>% count(installer.bin) %>% as.data.frame

train.values %>% filter(installer.bin == "other") %>% 
  group_by(installer) %>% count(installer) %>%
  arrange(desc(n)) %>% as.data.frame


# Bin the installers
test.values <- test.values %>% 
  mutate(installer.bin = case_when(str_detect(tolower(installer), "dwe") ~ "dwe", 
                                str_detect(tolower(installer), "government") ~ "government",
                                str_detect(tolower(installer), "hesawa") ~ "hesawa",
                                str_detect(tolower(installer), "rwe") ~ "rwe",
                                str_detect(tolower(installer), "commu") ~ "community",
                                str_detect(tolower(installer), "danid") ~ "danida",
                                str_detect(tolower(installer), "district council") ~ "district council",
                                str_detect(tolower(installer), "kkkt") ~ "kkkt",
                                str_detect(tolower(installer), "tcrs") ~ "tcrs",
                                str_detect(tolower(installer), "world vision") ~ "world vision",
                                str_detect(tolower(installer), "ces") ~ "ces",
                                str_detect(tolower(installer), "gover") ~ "government",
                                str_detect(tolower(installer), "amref") ~ "amref",
                                str_detect(tolower(installer), "lga") ~ "lga",
                                str_detect(tolower(installer), "tasaf") ~ "tasaf",
                                str_detect(tolower(installer), "wedeco") ~ "wedeco",
                                str_detect(tolower(installer), "fini water") ~ "fini water",
                                str_detect(tolower(installer), "dmdd") ~ "dmdd",
                                str_detect(tolower(installer), "norad") ~ "norad",
                                str_detect(tolower(installer), "twesa") ~ "twesa",
                                str_detect(tolower(installer), "da") ~ "da",
                                str_detect(tolower(installer), "wu") ~ "wu",
                                str_detect(tolower(installer), "acra") ~ "acra",
                                str_detect(tolower(installer), "sema") ~ "sema",
                                str_detect(tolower(installer), "dw") ~ "dw",
                                str_detect(tolower(installer), "oxfam") ~ "oxfam",
                                str_detect(tolower(installer), "unicef") ~ "unicef",
                                str_detect(tolower(installer), "shipo") ~ "shipo",
                                str_detect(tolower(installer), "idara ya maji") ~ "idara ya maji",
                                str_detect(tolower(installer), "gove") ~ "government",
                                str_detect(tolower(installer), "villagers") ~ "village",
                                str_detect(tolower(installer), "sengerema water department") ~ "sengerema water department",
                                str_detect(tolower(installer), "kiliwater") ~ "kiliwater",
                                str_detect(tolower(installer), "finw") ~ "fini water",
                                str_detect(tolower(installer), "rc church") ~ "rc church",
                                str_detect(tolower(installer), "dh") ~ "dh",
                                str_detect(tolower(installer), "kuwait") ~ "kuwait",
                                str_detect(tolower(installer), "dwsp") ~ "dwsp",
                                str_detect(tolower(installer), "distri") ~ "district",
                                str_detect(tolower(installer), "lawatefuka water sup") ~ "lawatefuka water sup",
                                str_detect(tolower(installer), "rc") ~ "rc church",
                                str_detect(tolower(installer), "magadini-makiwaru wa") ~ "magadini-makiwaru wa",
                                str_detect(tolower(installer), "fw") ~ "fw",
                                str_detect(tolower(installer), "district water department") ~ "district water department",
                                str_detect(tolower(installer), "kkkt _ konde and dwe") ~ "kkkt",
                                str_detect(tolower(installer), "centr") ~ "centr",
                                str_detect(tolower(installer), "private") ~ "private",
                                str_detect(tolower(installer), "wvt") ~ "wvt",
                                str_detect(tolower(installer), "mwe") ~ "mwe",
                                str_detect(tolower(installer), "handeni trunk main") ~ "handeni trunk main",
                                str_detect(tolower(installer), "water aid") ~ "water aid",
                                str_detect(tolower(installer), "world bank") ~ "world bank",
                                str_detect(tolower(installer), "wananchi") ~ "wananchi",
                                str_detect(tolower(installer), "rwssp") ~ "rwssp",
                                str_detect(tolower(installer), "jica") ~ "jica",
                                str_detect(tolower(installer), "central govt") ~ "government",
                                str_detect(tolower(installer), "adra") ~ "adra",
                                str_detect(tolower(installer), "artisan") ~ "artisan",
                                str_detect(tolower(installer), "isf") ~ "isf",
                                str_detect(tolower(installer), "mission") ~ "mission",
                                str_detect(tolower(installer), "ddca") ~ "ddca",
                                str_detect(tolower(installer), "he") ~ "he",
                                str_detect(tolower(installer), "tardo") ~ "tardo",
                                str_detect(tolower(installer), "consulting engineer") ~ "consulting engineer",
                                str_detect(tolower(installer), "twe") ~ "twe",
                                str_detect(tolower(installer), "muwsa") ~ "muwsa",
                                str_detect(tolower(installer), "ded") ~ "ded",
                                str_detect(tolower(installer), "village council") ~ "village",
                                str_detect(tolower(installer), "halmashauri ya wilaya sikonge") ~ "halmashauri ya wilaya sikonge",
                                str_detect(tolower(installer), "wizara ya maji") ~ "wizara ya maji",
                                str_detect(tolower(installer), "hsw") ~ "hsw",
                                str_detect(tolower(installer), "go") ~ "go",
                                str_detect(tolower(installer), "unisef") ~ "unicef",
                                str_detect(tolower(installer), "angli") ~ "angli",
                                str_detect(tolower(installer), "is") ~ "is",
                                str_detect(tolower(installer), "jaica") ~ "jaica",
                                str_detect(tolower(installer), "world") ~ "world",
                                str_detect(tolower(installer), "ir") ~ "ir",
                                str_detect(tolower(installer), "tassaf") ~ "tasaf",
                                str_detect(tolower(installer), "ki") ~ "ki",
                                str_detect(tolower(installer), "roman") ~ "roman",
                                str_detect(tolower(installer), "vwc") ~ "vwc",
                                str_detect(tolower(installer), "aict") ~ "aict",
                                str_detect(tolower(installer), "mdrdp") ~ "mdrdp",
                                str_detect(tolower(installer), "water board") ~ "water board",
                                str_detect(tolower(installer), "oikos e .africa") ~ "oikos e .africa",
                                str_detect(tolower(installer), "region water department") ~ "region water department",
                                str_detect(tolower(installer), "cefa") ~ "cefa",
                                str_detect(tolower(installer), "chamavita") ~ "chamavita",
                                str_detect(tolower(installer), "lwi") ~ "lwi",
                                str_detect(tolower(installer), "mtn") ~ "mtn",
                                str_detect(tolower(installer), "villa") ~ "village",
                                str_detect(tolower(installer), "gtz") ~ "gtz",
                                str_detect(tolower(installer), "oxfarm") ~ "oxfam",
                                is.na(installer) ~ "unknown",
                                TRUE ~ "other"))

test.values %>% count(installer.bin) %>% as.data.frame

test.values %>% filter(installer.bin == "other") %>% 
  group_by(installer) %>% count(installer) %>%
  arrange(desc(n)) %>% as.data.frame
```


## Review the data type changes
```{r reinspect-structure}
str(train.values)
str(train.labels)
str(test.values)
```
\newline


## Write out the cleansed data
```{r write-data}
write.csv(train.values, file = "../data/clean-training-set-values.csv", row.names=FALSE)
write.csv(test.values, file = "../data/clean-test-set-values.csv", row.names=FALSE)
```

