---
title: 'Predicting the Operational Status of Tanzanian Water Pumps'
subtitle: 'Data Processing'
author: "Thomas Skowronek"
date: "January 27, 2018"
output:
  html_document: default
  html_notebook: default
  pdf_document: default
  word_document: default
---


```{r setup-layout, cache=FALSE, echo=FALSE}
# Define the report layout.
library(knitr)

# Set global chunk options: images sizes for html and docx
output <- opts_knit$get("rmarkdown.pandoc.to")

if (output=="html") opts_chunk$set(fig.width=10, fig.height=6)
if (output=="docx") opts_chunk$set(fig.width=10,  fig.height=6)

# Set the printable width
options(width = 85)
```
\newline


# Setup
Set the working directory, clear all existing objects in the workspace and set the seed for reproducibility.  Lastly, load the necessary libraries.
```{r env-config, warning=FALSE, message=FALSE}
# Set the working directory
setwd("./")

# Clear all existing objects in the workspace
rm(list = ls())

# Set the seed for reproducible results
set.seed(1009)
```
\newline


# Attribute Definitions:
* id - Well identifier
* amount_tsh - Total static head (amount water available to waterpoint)
* date_recorded - The date the row was entered
* funder - Who funded the well
* gps_height - Altitude of the well
* installer - Organization that installed the well
* longitude - GPS coordinate
* latitude - GPS coordinate
* wpt_name - Name of the waterpoint if there is one
* num_private -
* basin - Geographic water basin
* subvillage - Geographic location
* region - Geographic location
* region_code - Geographic location (coded)
* district_code - Geographic location (coded)
* lga - Geographic location
* ward - Geographic location
* population - Population around the well
* public_meeting - True/False
* recorded_by - Group entering this row of data
* scheme_management - Who operates the waterpoint
* scheme_name - Who operates the waterpoint
* permit - If the waterpoint is permitted
* construction_year - Year the waterpoint was constructed
* extraction_type - The kind of extraction the waterpoint uses
* extraction_type_group - The kind of extraction the waterpoint uses
* extraction_type_class - The kind of extraction the waterpoint uses
* management - How the waterpoint is managed
* management_group - How the waterpoint is managed
* payment - What the water costs
* payment_type - What the water costs
* water_quality - The quality of the water
* quality_group - The quality of the water
* quantity - The quantity of water
* quantity_group - The quantity of water
* source - The source of the water
* source_type - The source of the water
* source_class - The source of the water
* waterpoint_type - The kind of waterpoint
* waterpoint_type_group - The kind of waterpoint
* status_group - The operational status of the well
    + functional - the waterpoint is operational and there are no repairs needed
    + functional needs repair - the waterpoint is operational, but needs repairs
    + non functional - the waterpoint is not operational

\newline


# Data Preperation

## Load the datasets
```{r load-data}
train.values <- read.csv("../data/src-training-set-values.csv", header = TRUE, na.strings = "")
train.labels <- read.csv("../data/src-training-set-labels.csv", header = TRUE)
test.values <- read.csv("../data/src-test-set-values.csv", header = TRUE, na.strings = "")
```
\newline


## Inspect the original structure of the datasets
```{r inspect-structure}
str(train.values)
str(train.labels)
str(test.values)
```
\newline


## Convert data types
```{r data-conversion}
# Convert the training values
train.values$date_recorded <- as.Date(train.values$date_recorded)
train.values$region_code <- as.factor(train.values$region_code)
train.values$district_code <- as.factor(train.values$district_code)
train.values$construction_year <- as.factor(train.values$construction_year)

# Convert the training labels
train.labels$status_group <- as.factor(train.labels$status_group)

# Convert the test values
test.values$date_recorded <- as.Date(test.values$date_recorded)
test.values$region_code <- as.factor(test.values$region_code)
test.values$district_code <- as.factor(test.values$district_code)
test.values$construction_year <- as.factor(test.values$construction_year)
```
\newline


## Cleanse attribute data
```{r data-cleanse}
missing.values <- c("none", "0", "-")

train.values$funder[tolower(train.values$funder) %in% missing.values] <- NA
train.values$installer[tolower(train.values$installer) %in% missing.values] <- NA
train.values$wpt_name[tolower(train.values$wpt_name) %in% missing.values] <- NA
train.values$construction_year[tolower(train.values$construction_year) %in% missing.values] <- NA
train.values$population[tolower(train.values$population) %in% missing.values] <- NA

test.values$funder[tolower(test.values$funder) %in% missing.values] <- NA
test.values$installer[tolower(test.values$installer) %in% missing.values] <- NA
test.values$wpt_name[tolower(test.values$wpt_name) %in% missing.values] <- NA
test.values$construction_year[tolower(test.values$construction_year) %in% missing.values] <- NA
test.values$population[tolower(test.values$population) %in% missing.values] <- NA
```
\newline


## Review the data type changes
```{r reinspect-structure}
str(train.values)
str(train.labels)
str(test.values)
```
\newline


## Write out the cleansed data
```{r write-data}
write.csv(train.values, file = "../data/clean-training-set-values.csv", row.names=FALSE)
write.csv(test.values, file = "../data/clean-test-set-values.csv", row.names=FALSE)
```

